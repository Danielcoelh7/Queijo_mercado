<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coelho Queijos</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FFD54F">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßÄ</text></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           1. ESTILOS GERAIS & ACESSIBILIDADE
           ========================================= */
        :root {
            --primary: #FFD54F;      /* Amarelo Logo */
            --accent: #000000;       /* Preto */
            --danger: #d32f2f;       /* Vermelho Escuro (Contraste) */
            --success: #2E7D32;      /* Verde Escuro */
            --bg-body: #FAFAFA;
            --radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--bg-body); 
            color: #222; /* Texto bem escuro */
            padding-bottom: 140px; /* Espa√ßo extra no final */
            font-size: 18px; /* Fonte base aumentada para idosos */
        }

        input, button, select { font-family: inherit; font-size: 1rem; }
        .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }

        /* HEADER */
        .header { 
            background: var(--primary); padding: 15px 0; text-align: center; 
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; 
            box-shadow: 0 4px 15px rgba(255, 213, 79, 0.4); 
            position: sticky; top: 0; z-index: 1000; 
        }
        .logo-img { max-width: 160px; height: auto; display: block; margin: 0 auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }

        /* INSTALAR APP (S√ì MOBILE) */
        #installAppContainer { display:none; padding:15px; text-align:center; background:#212121; color:white; margin-bottom: 20px; }
        
        /* Esconder bot√£o instalar no PC */
        @media (min-width: 1024px) {
            #installAppContainer { display: none !important; }
        }

        /* BUSCA & FILTROS */
        .search-section { padding: 25px 0 15px 0; }
        .search-input { width: 100%; padding: 15px 25px; border: 2px solid #ddd; border-radius: 50px; outline: none; transition: 0.3s; font-size: 1.1rem; }
        .search-input:focus { border-color: var(--primary); background: white; }

        .category-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 4px 25px 4px; scrollbar-width: none; }
        .category-pill { background: white; padding: 12px 25px; border-radius: 30px; white-space: nowrap; font-weight: 600; color: #555; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 2px solid transparent; font-size: 1rem; }
        .category-pill.active { background: var(--accent); color: var(--primary); transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* PRODUTOS (DESIGN GRANDE) */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 20px; }
        .product-card { background: white; border-radius: var(--radius); box-shadow: 0 5px 15px rgba(0,0,0,0.05); overflow: hidden; display: flex; flex-direction: column; position: relative; border: 1px solid #eee; }
        .product-card.sold-out { opacity: 0.7; filter: grayscale(100%); }

        .product-img-container { width: 100%; height: 180px; background: #f0f0f0; position: relative; }
        .product-img { width: 100%; height: 100%; object-fit: cover; }
        
        .sold-out-badge { position: absolute; top: 10px; right: 10px; background: var(--danger); color: white; font-size: 0.8rem; font-weight: 800; padding: 5px 12px; border-radius: 20px; display: none; }
        .product-card.sold-out .sold-out-badge { display: block; }

        .product-info { padding: 15px; flex-grow: 1; }
        .product-cat { font-size: 0.75rem; font-weight: 800; color: #FFB300; text-transform: uppercase; letter-spacing: 0.5px; }
        .product-name { font-size: 1.25rem; font-weight: 800; margin: 5px 0; line-height: 1.2; color: #000; }
        .product-desc { font-size: 0.9rem; color: #666; margin-bottom: 8px; }
        .product-stock { font-size: 0.85rem; color: #888; margin-bottom: 5px; }
        .product-price { font-size: 1.5rem; color: var(--danger); font-weight: 900; }

        /* CONTROLES (BOT√ïES GRANDES) */
        .user-controls-area { padding: 0 15px 15px 15px; }
        .qty-wrapper { display: flex; align-items: center; justify-content: space-between; background: #f5f5f5; border-radius: 15px; padding: 8px; margin-bottom: 12px; }
        .qty-btn { width: 45px; height: 45px; border-radius: 50%; border: none; background: white; font-weight: bold; cursor: pointer; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 1.5rem; }
        .qty-val { font-weight: bold; width: 50px; text-align: center; border: none; background: transparent; font-size: 1.2rem; }
        
        .add-btn { width: 100%; background: var(--accent); color: var(--primary); border: none; padding: 18px; border-radius: 15px; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 1rem; letter-spacing: 1px; }
        .add-btn:active { transform: scale(0.98); }
        .add-btn:disabled { background: #ccc; color: #fff; cursor: not-allowed; }

        /* PAINEL ADMIN */
        .admin-panel { background-color: #FFF8E1; border: 2px dashed #FFC107; padding: 15px; margin-top: 15px; border-radius: 10px; display: none; flex-direction: column; gap: 10px; }
        .admin-active .admin-panel { display: flex; }
        .admin-label { font-size: 0.85rem; font-weight: bold; color: #555; display: block; margin-bottom: 4px; }
        .admin-input { width: 100%; padding: 10px; border: 1px solid #FFC107; border-radius: 8px; text-align: center; font-weight: bold; background: white; font-size: 1.1rem; }
        .admin-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 5px; }
        .btn-admin { padding: 12px; border: none; border-radius: 8px; font-weight: bold; color: white; cursor: pointer; font-size: 0.9rem; }
        .btn-save { background-color: #2196F3; } /* Azul para salvar */
        .btn-toggle { background-color: var(--danger); }

        /* CARRINHO */
        .cart-section { background: white; border-radius: var(--radius); padding: 25px; box-shadow: 0 -5px 30px rgba(0,0,0,0.15); margin-top: 30px; display: none; }
        .cart-section.open { display: block; }
        
        .form-input { width: 100%; padding: 15px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 10px; outline: none; font-size: 1rem; }
        .form-input:focus { border-color: var(--primary); background: #fffde7; }

        /* FLUTUANTES */
        .sticky-cart-btn { position: fixed; bottom: 20px; right: 20px; background-color: var(--accent); color: var(--primary); padding: 18px 30px; border-radius: 50px; box-shadow: 0 10px 25px rgba(0,0,0,0.4); display: flex; align-items: center; gap: 12px; font-weight: 800; z-index: 900; cursor: pointer; border: 3px solid var(--primary); font-size: 1.1rem; }
        .cart-count-badge { background: var(--primary); color: var(--accent); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.9rem; }
        
        .sticky-call-btn { position: fixed; bottom: 95px; right: 25px; background-color: #25D366; color: white; padding: 12px 20px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-decoration: none; font-weight: bold; z-index: 900; display: flex; align-items: center; gap: 8px; font-size: 1rem; border: 2px solid white; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-overlay.open { display: flex; }
        .modal-card { background: white; width: 100%; max-width: 480px; border-radius: 20px; padding: 25px; max-height: 90vh; overflow-y: auto; }
        
        /* TOAST */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; width: 90%; max-width: 400px; pointer-events: none; }
        .toast { background: #333; color: #fff; padding: 15px 25px; border-radius: 50px; margin-bottom: 10px; text-align: center; opacity: 0; transition: 0.3s; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .toast.visible { opacity: 1; } .toast.success { background: var(--success); } .toast.error { background: var(--danger); }

        .footer { text-align: center; padding: 40px; color: #999; font-size: 0.8rem; }
        .admin-login-form { display: none; margin-top: 15px; justify-content: center; gap: 8px; }
        .admin-login-form.show { display: flex; }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="installAppContainer">
        <p style="margin-bottom:10px; font-weight:bold;">üì≤ Instale nosso App para facilitar!</p>
        <button id="installAppBtn" style="background:var(--primary); color:black; border:none; padding:12px 25px; border-radius:30px; font-weight:900; text-transform:uppercase;">INSTALAR AGORA</button>
    </div>

    <div id="receiptModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="text-align:center; margin-bottom:10px; color:#333;">üßæ Nota do Pedido</h3>
            
            <div style="background:#e8f5e9; border:2px solid #4CAF50; border-radius:10px; padding:15px; margin-bottom:20px; text-align:center;">
                <p style="font-size:0.9rem; margin-bottom:5px; font-weight:bold; color:#2E7D32;">üîë Chave PIX (Celular):</p>
                <div style="font-family:monospace; font-size:1.3rem; background:white; padding:8px; border-radius:6px; border:1px dashed #ccc; font-weight:bold; letter-spacing:1px;">
                    13988534927
                </div>
                <small style="color:#555; font-size:0.8rem; margin-top:5px; display:block;">Daniel Souza Coelho</small>
            </div>

            <div id="receiptText" style="background:#f4f4f4; padding:15px; font-family:monospace; white-space:pre-wrap; max-height:250px; overflow-y:auto; margin-bottom:15px; font-size:0.9rem; border:1px solid #ddd;"></div>
            
            <button onclick="sendWhatsapp()" style="width:100%; padding:18px; background:#25D366; color:white; border:none; border-radius:12px; font-weight:bold; font-size:1.1rem; margin-bottom:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1);">üì≤ Enviar no WhatsApp</button>
            <button onclick="closeReceipt()" style="width:100%; padding:12px; background:white; border:2px solid #d32f2f; color:#d32f2f; border-radius:12px; font-weight:bold;">Fechar</button>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <img src="logo.png" onerror="this.src='coelho quejos (1).png'" alt="Coelho Queijos" class="logo-img">
        </div>
    </header>

    <div class="container">
        <section class="search-section">
            <input type="search" id="searchInput" class="search-input" placeholder="üîç O que voc√™ procura hoje?">
        </section>

        <section class="category-scroll">
            <div class="category-pill active" onclick="filterCategory('all', this)">Todos</div>
            <div class="category-pill" onclick="filterCategory('queijos', this)">Queijos</div>
            <div class="category-pill" onclick="filterCategory('doces', this)">Doces</div>
            <div class="category-pill" onclick="filterCategory('geleias', this)">Geleias</div>
            <div class="category-pill" onclick="filterCategory('laticinios', this)">Latic√≠nios</div>
            <div class="category-pill" onclick="filterCategory('petiscos', this)">Petiscos</div>
        </section>

        <section style="padding-bottom: 20px;">
            <div id="productGrid" class="product-grid"></div>
            <div id="noResults" style="display:none; text-align:center; padding: 40px; color:#999; font-size:1.2rem;">Nenhum produto encontrado.</div>
        </section>

        <section class="cart-section" id="cartSection">
            <h2 style="margin-bottom: 20px; color:var(--accent); font-size:1.8rem;">üõí Sua Cesta</h2>
            
            <div id="cartItemsContainer"></div>
            
            <div style="margin-top:30px; background:#fff8e1; padding:20px; border-radius:15px; border:2px dashed #ffb300;">
                <h4 style="margin-bottom:15px; color:#d48806; font-size:1.2rem;">üìç Dados de Entrega:</h4>
                
                <input type="text" id="clientName" placeholder="Seu Nome Completo" class="form-input">
                <input type="tel" id="clientPhone" placeholder="WhatsApp (com DDD)" class="form-input">
                
                <div style="display:flex; gap:10px;">
                    <input type="text" id="clientAddress" placeholder="Endere√ßo (Rua)" class="form-input" style="flex:2;">
                    <input type="text" id="clientNumber" placeholder="N¬∫" class="form-input" style="flex:1;">
                </div>
                <input type="text" id="clientComp" placeholder="Complemento (Casa, Apto)" class="form-input">

                <label style="font-weight:bold; color:#555; margin-top:10px; display:block;">Selecione o Bairro/Cidade:</label>
                <select id="deliverySelect" class="form-input" onchange="updateDeliveryFee()" style="background:white; height:50px; font-weight:bold;">
                    </select>

                <div style="display:flex; justify-content:space-between; margin-top:15px; color:#666; font-size:1.1rem;">
                    <span>Produtos:</span>
                    <span id="cartTotalValue">R$ 0,00</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:5px; color:#666; font-size:1.1rem;">
                    <span>Taxa Entrega:</span>
                    <span id="deliveryDisplay" style="color:var(--danger); font-weight:bold;">Gr√°tis</span>
                </div>
                
                <hr style="margin:15px 0; border-top:1px dashed #ccc;">

                <div style="display:flex; justify-content:space-between; font-size:1.6rem; font-weight:900; color:var(--accent);">
                    <span>TOTAL:</span>
                    <span id="finalTotalDisplay">R$ 0,00</span>
                </div>

                <button onclick="generateReceipt()" style="width:100%; padding:20px; background:var(--accent); color:var(--primary); border:none; border-radius:15px; font-weight:900; margin-top:20px; font-size:1.2rem; box-shadow:0 5px 15px rgba(0,0,0,0.2);">
                    ENVIAR PEDIDO ‚úÖ
                </button>
            </div>
            
            <button onclick="clearCart()" style="margin-top:20px; width:100%; padding:15px; color:#d32f2f; background:white; border:2px solid #d32f2f; border-radius:10px; font-weight:bold;">üóëÔ∏è Esvaziar cesta</button>
        </section>
    </div>

    <a href="tel:5513988534927" class="sticky-call-btn">üìû Ajuda</a>
    
    <div class="sticky-cart-btn" onclick="toggleCartView()">
        <div class="cart-count-badge" id="floatingCartCount">0</div>
        <span>Ver Cesta</span>
    </div>

    <footer class="footer">
        <p>Coelho Queijos ‚Ä¢ Desde 2017</p>
        <div id="adminArea">
            <button onclick="document.getElementById('adminLoginForm').classList.toggle('show')" style="background:none; border:1px solid #ccc; padding:8px 20px; border-radius:20px; color:#888;">√Årea do Lojista üîí</button>
            <div id="adminLoginForm" class="admin-login-form">
                <input type="password" id="adminPass" placeholder="Senha" style="padding:10px; border:1px solid #ccc; border-radius:5px;">
                <button onclick="loginAdmin()" style="padding:10px 20px; background:#333; color:white; border:none; border-radius:5px;">OK</button>
            </div>
        </div>
    </footer>

    <script>
        // ==========================================
        // CONFIGURA√á√ÉO DO SISTEMA
        // ==========================================
        const BIN_ID = '696ad1eeae596e708fe18e2b'; 
        const API_KEY = '$2a$10$11iqh1McgX6s1NSao6L0W.71TsQU602UNg2yJFCzKKYcz1E7p8ZOK'; 
        const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

        // LISTA DE PRODUTOS
        const defaultProducts = [
            { id: 1, name: "Ovos (Pente 30 un)", category: "laticinios", price: 24.0, image: "ovo.jpeg", desc: "Ovos frescos da granja", stock: 20, soldOut: false },
            { id: 2, name: "Doce de Leite (Cubo)", category: "doces", price: 15.0, image: "leite_peda.jpeg", desc: "400g tradicional em peda√ßos", stock: 15, soldOut: false },
            { id: 3, name: "Doce de Leite Cremoso", category: "doces", price: 15.0, image: "leite.jpeg", desc: "400g pote cremoso", stock: 15, soldOut: false },
            { id: 4, name: "Doce de Leite c/ Coco", category: "doces", price: 15.0, image: "coco.jpeg", desc: "400g cremoso com coco", stock: 10, soldOut: false },
            { id: 5, name: "Doce de Leite c/ Ameixa", category: "doces", price: 15.0, image: "ameixa.jpeg", desc: "400g cremoso com ameixa", stock: 10, soldOut: false },
            { id: 6, name: "Requeij√£o de Corte", category: "queijos", price: 35.0, image: "requeijao.jpeg", desc: "Barra artesanal saborosa", stock: 10, soldOut: false },
            { id: 7, name: "Goiabada Casc√£o", category: "doces", price: 15.0, image: "goiabada.jpeg", desc: "Barra 500g com peda√ßos", stock: 20, soldOut: false },
            { id: 8, name: "Bananinha Cristalizada", category: "doces", price: 7.0, image: "bananinha.jpeg", desc: "Pacote 200g", stock: 30, soldOut: false },
            { id: 9, name: "Manteiga", category: "laticinios", price: 28.0, image: "manteiga.jpeg", desc: "Pote da fazenda, amarelinha", stock: 12, soldOut: false },
            { id: 10, name: "Biscoito Caseiro", category: "petiscos", price: 7.0, image: "biscoito.jpeg", desc: "Pacote sortido crocante", stock: 20, soldOut: false },
            { id: 11, name: "Geleia de Morango", category: "geleias", price: 35.0, image: "morango.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 12, name: "Geleia de Jabuticaba", category: "geleias", price: 35.0, image: "jabuticaba.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 13, name: "Geleia de Amora", category: "geleias", price: 35.0, image: "amora.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 14, name: "Geleia de Uva", category: "geleias", price: 35.0, image: "uva.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 15, name: "Mel Puro", category: "doces", price: 40.0, image: "mel.jpeg", desc: "Garrafa de vidro", stock: 10, soldOut: false },
            { id: 16, name: "Queijo", category: "queijos", price: 50.0, image: "queijo.jpeg", desc: "Pe√ßa especial", stock: 10, soldOut: false },
            { id: 17, name: "Pururuca", category: "petiscos", price: 20.0, image: "pururuca.jpeg", desc: "Crocante", stock: 15, soldOut: false },
            { id: 18, name: "Manteiga de Garrafa", category: "laticinios", price: 20.0, image: "garrafa.jpeg", desc: "275ml (Pequena)", stock: 2, soldOut: false },
            { id: 19, name: "Doce de Leite c/ Coco (Cubo)", category: "doces", price: 15.0, image: "coco_pedaco.jpeg", desc: "400g tradicional em peda√ßos", stock: 10, soldOut: false },
            { id: 20, name: "P√© de Moleque", category: "doces", price: 15.0, image: "moleque.jpeg", desc: "400g tradicional em peda√ßos", stock: 10, soldOut: false },
            { id: 21, name: "Bananinha natural", category: "doces", price: 17.0, image: "bananinha_natural.jpeg", desc: "250g contendo 10 unidades", stock: 10, soldOut: false },
            { id: 22, name: "P√£o de Queijo", category: "queijos", price: 40.0, image: "pao_queijo.jpeg", desc: "50 Unidades", stock: 10, soldOut: false }
        ];

        // ZONAS DE ENTREGA
        const deliveryZones = [
            { name: "Retirar na Loja (Sem taxa)", price: 0.00 },
            { name: "Cubat√£o - Centro", price: 6.00 },
            { name: "Cubat√£o - Vila Nova", price: 6.00 },
            { name: "Cubat√£o - Vila Esperan√ßa", price: 5.00 },
            { name: "Cubat√£o - Vila Natal", price: 6.00 },
            { name: "Cubat√£o - Costa e Silva", price: 7.00 },
            { name: "Cubat√£o - Casqueiro", price: 10.00 },
            { name: "Cubat√£o - Bols√£o 7", price: 12.00 },
            { name: "Cubat√£o - Bols√£o 8", price: 12.00 },
            { name: "Cubat√£o - Bols√£o 9", price: 12.00 },
            { name: "Santos", price: 20.00 },
            { name: "S√£o Vicente", price: 20.00 },
            { name: "Praia Grande", price: 35.00 },
            { name: "Outro Local (Combinar no Zap)", price: 0.00 } 
        ];

        // VARI√ÅVEIS DO SISTEMA
        let products = [];
        let cart = [];
        let currentCategory = 'all';
        let currentDeliveryFee = 0;
        let generatedReceiptText = "";

        // INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', () => {
            loadDataOnline(); 
            initDeliveryOptions();
            
            // PWA INSTALADOR
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installAppContainer').style.display = 'block';
            });
            document.getElementById('installAppBtn').addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') document.getElementById('installAppContainer').style.display = 'none';
                    deferredPrompt = null;
                }
            });
        });

        // PWA SERVICE WORKER
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
        }

        // --- FUN√á√ïES ONLINE ---
        async function loadDataOnline() {
            showToast("Verificando estoque...", "info");
            if(BIN_ID.includes("COLE_SEU")) { products = JSON.parse(JSON.stringify(defaultProducts)); renderCatalog(); return; }
            try {
                const res = await fetch(API_URL + '/latest', { headers: { 'X-Master-Key': API_KEY } });
                if (!res.ok) throw new Error();
                const data = await res.json();
                products = data.record;
                renderCatalog();
            } catch (e) {
                console.error(e);
                products = JSON.parse(JSON.stringify(defaultProducts));
                renderCatalog();
            }
        }

        async function saveDataOnline() {
            if(BIN_ID.includes("COLE_SEU")) return showToast("Erro: Chaves n√£o configuradas", "error");
            showToast("Salvando nuvem...", "info");
            try {
                await fetch(API_URL, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY }, body: JSON.stringify(products) });
                showToast("‚úÖ Salvo com sucesso!", "success");
            } catch (e) { showToast("Erro ao salvar", "error"); }
        }

        // --- RENDERIZA√á√ÉO ---
        function renderCatalog() {
            const grid = document.getElementById('productGrid');
            const term = document.getElementById('searchInput').value.toLowerCase();
            grid.innerHTML = '';
            let count = 0;

            products.forEach(p => {
                if(currentCategory !== 'all' && p.category !== currentCategory) return;
                if(term && !p.name.toLowerCase().includes(term)) return;
                count++;

                const isSoldOut = p.soldOut || p.stock <= 0;
                
                const html = `
                    <article class="product-card ${isSoldOut ? 'sold-out' : ''}">
                        <div class="sold-out-badge">ESGOTADO</div>
                        <div class="product-img-container">
                            <img src="${p.image}" onerror="this.src='https://via.placeholder.com/150?text=Sem+Foto'" class="product-img">
                        </div>
                        <div class="product-info">
                            <div class="product-cat">${p.category}</div>
                            <div class="product-name">${p.name}</div>
                            <div class="product-desc">${p.desc}</div>
                            <div class="product-stock">Estoque: ${p.stock} un</div>
                            <div class="product-price">R$ ${p.price.toFixed(2).replace('.', ',')}</div>
                        </div>
                        
                        <div class="user-controls-area">
                            <div class="qty-wrapper">
                                <button class="qty-btn" onclick="changeQty(${p.id}, -1)">-</button>
                                <input id="qty-${p.id}" class="qty-val" value="1" readonly>
                                <button class="qty-btn" onclick="changeQty(${p.id}, 1)">+</button>
                            </div>
                            <button class="add-btn" onclick="addToCart(${p.id})" ${isSoldOut?'disabled':''}>${isSoldOut?'Indispon√≠vel':'ADICIONAR'}</button>

                            <div class="admin-panel">
                                <div style="display:flex; gap:5px; margin-bottom:5px;">
                                    <div style="flex:1;">
                                        <label class="admin-label">Estoque:</label>
                                        <input type="number" id="admin-stock-${p.id}" class="admin-input" value="${p.stock}">
                                    </div>
                                    <div style="flex:1;">
                                        <label class="admin-label">Pre√ßo:</label>
                                        <input type="number" id="admin-price-${p.id}" class="admin-input" value="${p.price}" step="0.50">
                                    </div>
                                </div>
                                <div class="admin-actions">
                                    <button class="btn-admin btn-save" onclick="adminUpdateData(${p.id})">üíæ SALVAR</button>
                                    <button class="btn-admin btn-toggle" onclick="adminToggleStatus(${p.id})">${p.soldOut?'ATIVAR':'ESGOTAR'}</button>
                                </div>
                            </div>
                        </div>
                    </article>
                `;
                grid.innerHTML += html;
            });
            document.getElementById('noResults').style.display = count === 0 ? 'block' : 'none';
        }

        // --- CARRINHO & FRETE ---
        function initDeliveryOptions() {
            const select = document.getElementById('deliverySelect');
            select.innerHTML = '';
            deliveryZones.forEach((zone, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                const priceTxt = zone.price === 0 ? "Gr√°tis" : `R$ ${zone.price.toFixed(2).replace('.',',')}`;
                opt.text = `${zone.name} (+ ${priceTxt})`;
                select.appendChild(opt);
            });
        }

        function updateDeliveryFee() {
            const idx = document.getElementById('deliverySelect').value;
            currentDeliveryFee = deliveryZones[idx].price;
            document.getElementById('deliveryDisplay').innerText = currentDeliveryFee === 0 ? "Gr√°tis" : `R$ ${currentDeliveryFee.toFixed(2).replace('.',',')}`;
            calculateFinalTotal();
        }

        function calculateFinalTotal() {
            const prodTotal = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            const final = prodTotal + currentDeliveryFee;
            document.getElementById('cartTotalValue').innerText = 'R$ ' + prodTotal.toFixed(2).replace('.',',');
            document.getElementById('finalTotalDisplay').innerText = 'R$ ' + final.toFixed(2).replace('.',',');
        }

        function changeQty(id, delta) {
            const el = document.getElementById(`qty-${id}`);
            let val = parseInt(el.value) + delta;
            if(val < 1) val = 1;
            el.value = val;
        }

        function addToCart(id) {
            if(navigator.vibrate) navigator.vibrate(50); // Vibra√ß√£o
            const p = products.find(x => x.id === id);
            const qty = parseInt(document.getElementById(`qty-${id}`).value);
            if(p.soldOut || p.stock <= 0) return showToast("Esgotado!", "error");
            
            const item = cart.find(x => x.id === id);
            const cur = item ? item.qty : 0;
            if(cur + qty > p.stock) return showToast(`Estoque insuficiente! Restam ${p.stock}`, "error");

            if(item) item.qty += qty; else cart.push({...p, qty: qty});
            
            document.getElementById(`qty-${id}`).value = 1;
            updateCartUI();
            showToast("Adicionado √† Cesta!", "success");
        }

        function updateCartUI() {
            const container = document.getElementById('cartItemsContainer');
            const badge = document.getElementById('floatingCartCount');
            container.innerHTML = '';
            let count = 0;

            if(cart.length === 0) container.innerHTML = '<p style="text-align:center; color:#999; padding:20px;">Sua cesta est√° vazia.</p>';

            cart.forEach((i, idx) => {
                count += i.qty;
                container.innerHTML += `
                    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:15px 0;">
                        <div>
                            <div style="font-weight:bold; font-size:1.1rem;">${i.name}</div>
                            <div style="color:#666;">${i.qty}x R$ ${i.price.toFixed(2)}</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div style="font-weight:bold; font-size:1.1rem;">R$ ${(i.qty*i.price).toFixed(2).replace('.',',')}</div>
                            <button onclick="cart.splice(${idx},1); updateCartUI()" style="color:red; background:none; border:none; font-size:1.5rem; font-weight:bold;">&times;</button>
                        </div>
                    </div>`;
            });
            badge.innerText = count;
            calculateFinalTotal();
        }

        function clearCart() { if(confirm("Limpar toda a cesta?")) { cart = []; updateCartUI(); } }
        function toggleCartView() { 
            const el = document.getElementById('cartSection');
            if(el.style.display==='block'){ el.style.display='none'; } else { el.style.display='block'; el.scrollIntoView({behavior:'smooth'}); }
        }

        // --- CHECKOUT ---
        function generateReceipt() {
            if(cart.length===0) return showToast("Cesta vazia!", "error");
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const addr = document.getElementById('clientAddress').value.trim();
            const num = document.getElementById('clientNumber').value.trim();
            const comp = document.getElementById('clientComp').value.trim();

            if(!name || !phone) {
                document.querySelector('.cart-section').scrollIntoView({behavior:'smooth'});
                return showToast("Preencha Nome e WhatsApp!", "error");
            }
            if(currentDeliveryFee > 0 && !addr) {
                 return showToast("Preencha o endere√ßo!", "error");
            }

            const dataHora = new Date().toLocaleString('pt-BR');
            const zoneIdx = document.getElementById('deliverySelect').value;
            const zoneName = deliveryZones[zoneIdx].name;

            let txt = `*PEDIDO - COELHO QUEIJOS*\n`;
            txt += `üìÖ ${dataHora}\n`;
            txt += `üë§ ${name}\nüì± ${phone}\n`;
            
            if(currentDeliveryFee > 0) {
                txt += `üìç Entrega: ${zoneName}\n   ${addr}, ${num} ${comp ? '- '+comp : ''}\n`;
            } else {
                txt += `üìç *RETIRADA NO BALC√ÉO*\n`;
            }
            
            txt += `------------------\n`;
            let sub = 0;
            cart.forEach(i => {
                txt += `${i.qty}x ${i.name} (R$ ${(i.qty*i.price).toFixed(2)})\n`;
                sub += i.qty*i.price;
            });
            txt += `------------------\n`;
            txt += `Subtotal: R$ ${sub.toFixed(2).replace('.',',')}\n`;
            txt += `Entrega: ${currentDeliveryFee===0?'Gr√°tis':'R$ '+currentDeliveryFee.toFixed(2).replace('.',',')}\n`;
            txt += `*TOTAL: R$ ${(sub+currentDeliveryFee).toFixed(2).replace('.',',')}*\n`;
            
            generatedReceiptText = txt;
            document.getElementById('receiptText').innerText = txt;
            document.getElementById('receiptModal').classList.add('open');
        }

        function closeReceipt() { document.getElementById('receiptModal').classList.remove('open'); }
        function sendWhatsapp() { window.open(`https://wa.me/5513988534927?text=${encodeURIComponent(generatedReceiptText)}`); }

        // --- ADMIN ---
        function loginAdmin() {
            if(document.getElementById('adminPass').value === 'admin') {
                document.body.classList.add('admin-active');
                document.getElementById('adminLoginForm').classList.remove('show');
                showToast("Modo Admin Ativo!", "success");
                renderCatalog();
            } else { showToast("Senha inv√°lida", "error"); }
        }

        function adminUpdateData(id) {
            const stock = parseInt(document.getElementById(`admin-stock-${id}`).value);
            const price = parseFloat(document.getElementById(`admin-price-${id}`).value);
            const p = products.find(x => x.id === id);
            if(p) {
                p.stock = stock;
                if(!isNaN(price) && price > 0) p.price = price;
                if(p.stock > 0) p.soldOut = false; else p.soldOut = true;
                saveDataOnline().then(() => renderCatalog());
            }
        }

        function adminToggleStatus(id) {
            const p = products.find(x => x.id === id);
            if(p) { p.soldOut = !p.soldOut; saveDataOnline().then(() => renderCatalog()); }
        }

        function filterCategory(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.category-pill').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            renderCatalog();
        }
        document.getElementById('searchInput').addEventListener('input', renderCatalog);

        function showToast(msg, type) {
            const t = document.createElement('div'); t.className = `toast ${type}`; t.innerText = msg;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(()=>t.classList.add('visible'),10); setTimeout(()=>t.remove(),3000);
        }
    </script>
</body>
</html>
