<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coelho Queijos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           1. VARI√ÅVEIS E TEMA (COELHO QUEIJOS)
           ========================================= */
        :root {
            --primary: #FFD54F;      /* Amarelo da Logo */
            --primary-dark: #FFCA28; /* Amarelo mais escuro */
            --accent: #000000;       /* Preto (Contraste da logo) */
            --danger: #FF5252;       /* Vermelho Erro */
            --bg-body: #FAFAFA;      /* Fundo quase branco */
            --bg-card: #FFFFFF;
            --text-main: #333333;
            --text-light: #666666;
            --shadow: 0 8px 20px rgba(0,0,0,0.08);
            --radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            line-height: 1.5;
            padding-bottom: 120px;
        }

        input, button { font-family: inherit; font-size: 1rem; }
        .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }

        /* =========================================
           2. CABE√áALHO COM LOGO
           ========================================= */
        .header {
            background: var(--primary); 
            padding: 15px 0; 
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 213, 79, 0.4); 
            position: sticky; top: 0; z-index: 1000;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }
        
        .logo-img {
            max-width: 180px; /* Tamanho da logo */
            height: auto;
            display: block;
            margin: 0 auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        /* =========================================
           3. UI GERAL (BUSCA, CATEGORIAS)
           ========================================= */
        .search-section { padding: 25px 0 15px 0; }
        .search-input {
            width: 100%; padding: 15px 25px; border: 2px solid transparent;
            border-radius: 50px; background: white; box-shadow: var(--shadow);
            outline: none; transition: all 0.3s; font-size: 1rem;
        }
        .search-input:focus { border-color: var(--primary); transform: scale(1.02); }

        .category-scroll {
            display: flex; gap: 12px; overflow-x: auto; padding: 10px 4px 25px 4px;
            scrollbar-width: none;
        }
        .category-scroll::-webkit-scrollbar { display: none; }

        .category-pill {
            background: white; padding: 10px 20px; border-radius: 30px;
            white-space: nowrap; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            font-weight: 600; color: var(--text-light); cursor: pointer;
            border: 2px solid transparent; transition: all 0.2s;
        }
        .category-pill.active {
            background: var(--accent); color: var(--primary);
            border-color: var(--accent); transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* =========================================
           4. CARDS DE PRODUTOS (NOVO DESIGN COM FOTO)
           ========================================= */
        .catalog-section { padding-bottom: 20px; }
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px;
        }

        .product-card {
            background: white; border-radius: var(--radius); 
            box-shadow: var(--shadow); display: flex; flex-direction: column;
            overflow: hidden; transition: transform 0.2s; border: none;
            position: relative;
        }
        
        .product-card.sold-out { opacity: 0.7; filter: grayscale(100%); }

        /* √Årea da Foto */
        .product-img-container {
            width: 100%;
            height: 150px;
            overflow: hidden;
            position: relative;
            background-color: #eee;
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Faz a foto preencher tudo sem esticar */
            transition: transform 0.3s;
        }
        
        .product-card:hover .product-img { transform: scale(1.1); }

        .sold-out-badge {
            position: absolute; top: 10px; right: 10px;
            background: var(--danger); color: white; font-size: 0.7rem; font-weight: 800;
            padding: 5px 10px; border-radius: 20px; z-index: 10; display: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .product-card.sold-out .sold-out-badge { display: block; }

        /* Informa√ß√µes do Produto */
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-cat-tag { 
            font-size: 0.65rem; text-transform: uppercase; color: var(--primary-dark); 
            font-weight: 800; letter-spacing: 0.5px; margin-bottom: 5px;
        }
        .product-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 5px; line-height: 1.2; color: #000; }
        .product-desc { font-size: 0.8rem; color: #777; margin-bottom: 10px; line-height: 1.3; }
        .product-stock { font-size: 0.75rem; color: #999; margin-top: auto; margin-bottom: 5px; }
        .product-price { font-size: 1.3rem; color: var(--accent); font-weight: 800; }

        /* Controles */
        .user-controls {
            display: flex; align-items: center; justify-content: space-between;
            margin-top: 10px; background: #f8f8f8; border-radius: 12px; padding: 5px;
        }
        .qty-btn-card {
            width: 30px; height: 30px; background: white; border: none;
            border-radius: 50%; font-weight: bold; font-size: 1.2rem; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); color: var(--accent);
        }
        .qty-input-card { width: 30px; text-align: center; border: none; background: transparent; font-weight: bold; font-size: 1rem; }

        .add-cart-btn {
            width: 100%; margin-top: 15px; background: var(--accent);
            color: var(--primary); border: none; padding: 12px;
            border-radius: 12px; font-weight: 700; cursor: pointer; 
            transition: all 0.2s; text-transform: uppercase; font-size: 0.9rem;
            letter-spacing: 1px;
        }
        .add-cart-btn:active { transform: scale(0.98); }
        .add-cart-btn:disabled { background: #ccc; color: #fff; cursor: not-allowed; }

        /* =========================================
           5. CARRINHO FLUTUANTE
           ========================================= */
        .sticky-cart-btn {
            position: fixed; bottom: 20px; right: 20px;
            background-color: var(--accent); color: var(--primary);
            padding: 15px 25px; border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            display: flex; align-items: center; gap: 12px;
            font-weight: 800; z-index: 900; cursor: pointer;
            transition: transform 0.2s; border: 2px solid var(--primary);
        }
        .sticky-cart-btn:active { transform: scale(0.95); }
        .cart-count-badge {
            background: var(--primary); color: var(--accent); font-size: 0.9rem;
            width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-weight: 900;
        }

        /* =========================================
           6. SE√á√ÉO DO CARRINHO (EXPANDIDA)
           ========================================= */
        .cart-section {
            background: white; border-radius: var(--radius); padding: 25px;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.15); margin-top: 30px; display: none;
        }
        .cart-section.open { display: block; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .cart-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid #eee;
        }
        .client-form { margin-top: 25px; background: #FFFDE7; padding: 20px; border-radius: 15px; border: 2px dashed var(--primary); }
        .form-input { width: 100%; padding: 15px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 10px; outline: none; }
        .form-input:focus { border-color: var(--primary); background: white; }
        .checkout-btn { width: 100%; padding: 18px; background: #25D366; color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3); }

        /* =========================================
           7. MODAL / TOAST / ADMIN
           ========================================= */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; width: 90%; max-width: 400px; pointer-events: none; }
        .toast { background: #333; color: #fff; padding: 12px 20px; border-radius: 50px; margin-bottom: 10px; text-align: center; opacity: 0; transform: translateY(-20px); transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-weight: 600; }
        .toast.visible { opacity: 1; transform: translateY(0); }
        .toast.success { background-color: var(--accent); color: var(--primary); }
        .toast.error { background-color: var(--danger); }

        /* Modal Nota */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; backdrop-filter: blur(5px); }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
        .modal-card { background: white; width: 100%; max-width: 450px; border-radius: 25px; overflow: hidden; display: flex; flex-direction: column; max-height: 85vh; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-header { background: var(--primary); padding: 20px; text-align: center; font-weight: 800; color: var(--accent); font-size: 1.3rem; }
        .receipt-paper { background: #f9f9f9; padding: 25px; font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; color: #333; overflow-y: auto; white-space: pre-wrap; border-bottom: 2px dashed #ccc; }
        .modal-actions { padding: 20px; background: white; display: flex; flex-direction: column; gap: 10px; }
        .btn-modal { padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; transition: transform 0.1s; }
        .btn-modal:active { transform: scale(0.98); }
        .btn-whatsapp { background: #25D366; color: white; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3); }
        .btn-copy { background: #eee; color: #333; }
        .btn-close { background: transparent; color: var(--danger); border: 2px solid var(--danger); }

        /* Admin Panel no Card */
        .admin-panel { margin-top: 10px; padding-top: 10px; border-top: 2px dashed #eee; display: none; flex-direction: column; gap: 8px; }
        .admin-active .admin-panel { display: flex; }
        .admin-row { display: flex; gap: 5px; }
        .admin-input { flex: 1; padding: 8px; border: 1px solid #ccc; text-align: center; border-radius: 8px; }
        .admin-btn { flex: 1; padding: 8px; font-size: 0.75rem; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; }
        .btn-update { background: var(--text-light); }
        .btn-toggle { background: var(--danger); }

        .footer { text-align: center; padding: 40px 20px; color: #999; font-size: 0.85rem; }
        .admin-login-area { margin-top: 20px; display: flex; justify-content: center; }
        .admin-login-btn { background: none; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px; color: #aaa; cursor: pointer; font-size: 0.75rem; }
        .admin-login-form { display: none; gap: 5px; margin-top: 10px; justify-content: center; }
        .admin-login-form.show { display: flex; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="receiptModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">üßæ Nota do Pedido</div>
            <div id="receiptText" class="receipt-paper">Gerando...</div>
            <div class="modal-actions">
                <button class="btn-modal btn-whatsapp" onclick="sendWhatsapp()">üì≤ Enviar no WhatsApp</button>
                <button class="btn-modal btn-copy" onclick="copyReceipt()">üìã Copiar Texto</button>
                <button class="btn-modal btn-close" onclick="closeReceipt()">‚ùå Voltar</button>
            </div>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <img src="logo.png" alt="Coelho Queijos" class="logo-img">
        </div>
    </header>

    <div class="container">
        
        <section class="search-section">
            <input type="search" id="searchInput" class="search-input" placeholder="üîç O que voc√™ procura hoje?">
        </section>

        <section class="category-scroll">
            <div class="category-pill active" onclick="filterCategory('all', this)">Todos</div>
            <div class="category-pill" onclick="filterCategory('queijos', this)">Queijos</div>
            <div class="category-pill" onclick="filterCategory('doces', this)">Doces</div>
            <div class="category-pill" onclick="filterCategory('geleias', this)">Geleias</div>
            <div class="category-pill" onclick="filterCategory('laticinios', this)">Latic√≠nios</div>
            <div class="category-pill" onclick="filterCategory('petiscos', this)">Petiscos</div>
        </section>

        <section class="catalog-section">
            <div id="productGrid" class="product-grid"></div>
            <div id="noResults" style="display:none; text-align:center; padding: 40px; color:#999; font-weight:600;">
                Nenhum produto encontrado. üòï
            </div>
        </section>

        <section class="cart-section" id="cartSection">
            <h2 style="margin-bottom: 20px; font-weight: 800; color: var(--accent);">üõí Sua Cesta</h2>
            
            <div id="cartItemsContainer"></div>

            <div style="text-align: right; font-size: 1.5rem; font-weight: 800; color: var(--accent); margin: 25px 0;">
                Total: <span id="cartTotalValue">R$ 0,00</span>
            </div>
            
            <button onclick="clearCart()" style="color: var(--danger); background:none; border:none; text-decoration:underline; cursor:pointer; font-size:0.9rem;">Esvaziar cesta</button>

            <div class="client-form">
                <h4 style="margin-bottom:15px; color:var(--text-main);">üìç Dados para entrega:</h4>
                <input type="text" id="clientName" class="form-input" placeholder="Seu Nome Completo">
                <input type="tel" id="clientPhone" class="form-input" placeholder="Seu WhatsApp (com DDD)">
                <button class="checkout-btn" onclick="generateReceipt()">Finalizar Pedido ‚úÖ</button>
            </div>
        </section>
    </div>

    <div class="sticky-cart-btn" onclick="toggleCartView()">
        <div class="cart-count-badge" id="floatingCartCount">0</div>
        <span>Ver Cesta</span>
    </div>

    <footer class="footer">
        <p>Coelho Queijos ‚Ä¢ Desde 2017</p>
        <div class="admin-login-area">
            <div id="adminLoginTrigger">
                <button class="admin-login-btn" onclick="showAdminForm()">√Årea do Lojista üîí</button>
            </div>
            <div id="adminLoginForm" class="admin-login-form">
                <input type="password" id="adminPass" placeholder="Senha" style="padding: 5px; border-radius: 4px; border:1px solid #ccc;">
                <button onclick="loginAdmin()" style="background: var(--accent); color: white; border:none; padding: 5px 10px; border-radius: 4px;">Entrar</button>
            </div>
            <div id="adminLogoutArea" style="display:none;">
                <span style="color: var(--accent); font-weight:bold;">Modo Editor Ativo</span>
                <button onclick="logoutAdmin()" style="margin-left:10px; color: var(--danger); background:none; border:none; text-decoration:underline; cursor:pointer;">Sair</button>
            </div>
        </div>
    </footer>

    <script>
        // ==========================================
        // 0. CONFIGURA√á√ÉO ONLINE (JSONBIN)
        // ==========================================
        const BIN_ID = '696ad1eeae596e708fe18e2b'; 
        const API_KEY = '$2a$10$11iqh1McgX6s1NSao6L0W.71TsQU602UNg2yJFCzKKYcz1E7p8ZOK'; 
        const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

        // ==========================================
        // 1. LISTA DE PRODUTOS (COM FOTOS ILUSTRATIVAS)
        // ==========================================
        // NOTA PARA O USU√ÅRIO: Para usar suas fotos, coloque os arquivos na pasta e 
        // mude o campo "image" para o nome do arquivo. Ex: "image": "ovos.jpg"
        
        const defaultProducts = [
            { id: 1, name: "Ovos (Pente 30 un)", category: "laticinios", price: 24.00, image: "ovo.jpeg", desc: "Ovos frescos da granja", stock: 20, soldOut: false },
            { id: 2, name: "Doce de Leite (Cubo)", category: "doces", price: 15.00, image: "leite_peda.jpeg", desc: "400g tradicional em peda√ßos", stock: 15, soldOut: false },
            { id: 3, name: "Doce de Leite Cremoso", category: "doces", price: 15.00, image: "leite.jpeg", desc: "400g pote cremoso", stock: 15, soldOut: false },
            { id: 4, name: "Doce de Leite c/ Coco", category: "doces", price: 15.00, image: "coco.jpeg", desc: "400g cremoso com coco", stock: 10, soldOut: false },
            { id: 5, name: "Doce de Leite c/ Ameixa", category: "doces", price: 15.00, image: "ameixa.jpeg", desc: "400g cremoso com ameixa", stock: 10, soldOut: false },
            { id: 6, name: "Requeij√£o de Corte", category: "queijos", price: 35.00, image: "requeijao.jpeg", desc: "Barra artesanal saborosa", stock: 10, soldOut: false },
            { id: 7, name: "Goiabada Casc√£o", category: "doces", price: 15.00, image: "goiabada.jpeg", desc: "Barra 500g com peda√ßos", stock: 20, soldOut: false },
            { id: 8, name: "Bananinha Cristalizada", category: "doces", price: 7.00, image: "bananinha.jpeg", desc: "Pacote 200g", stock: 30, soldOut: false },
            { id: 9, name: "Manteiga", category: "laticinios", price: 28.00, image: "manteiga.jpeg", desc: "Pote da fazenda, amarelinha", stock: 12, soldOut: false },
            { id: 10, name: "Biscoito Caseiro", category: "petiscos", price: 7.00, image: "biscoito.jpeg", desc: "Pacote sortido crocante", stock: 20, soldOut: false },
            { id: 11, name: "Geleia de Morango", category: "geleias", price: 35.00, image: "morango.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 12, name: "Geleia de Jabuticaba", category: "geleias", price: 35.00, image: "jabuticaba.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 13, name: "Geleia de Amora", category: "geleias", price: 35.00, image: "amora.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 14, name: "Geleia de Uva", category: "geleias", price: 35.00, image: "uva.jpeg", desc: "Pote 680g artesanal", stock: 8, soldOut: false },
            { id: 15, name: "Mel Puro", category: "doces", price: 40.00, image: "mel.jpeg", desc: "Garrafa de vidro", stock: 10, soldOut: false },
            { id: 16, name: "Queijo", category: "queijos", price: 50.00, image: "queijo.jpeg", desc: "Pe√ßa especial", stock: 10, soldOut: false },
            { id: 17, name: "Pururuca", category: "petiscos", price: 20.00, image: "pururuca.jpeg", desc: "Crocante", stock: 15, soldOut: false },
            { id: 18, name: "Manteiga de Garrafa", category: "laticinios", price: 20.00, image: "garrafa.jpeg", desc: "275ml (Pequena)", stock: 2, soldOut: false },
            { id: 19, name: "Doce de Leite c/ Coco (Cubo)", category: "doces", price: 15.00, image: "coco_pedaco.jpeg", desc: "400g tradicional em peda√ßos", stock: 10, soldOut: false },
            { id: 20, name: "P√© de Moleque", category: "doces", price: 15.00, image: "moleque.jpeg", desc: "400g tradicional em peda√ßos", stock: 10, soldOut: false },
            { id: 21, name: "Bananinha natural", category: "doces", price: 17.00, image: "bananinha_natural.jpeg", desc: "250g contendo 10 unidades", stock: 10, soldOut: false },
            { id: 22, name: "P√£o de Queijo", category: "queijos", price: 40.00, image: "pao_queijo.jpeg", desc: "50 Unidades", stock: 10, soldOut: false }


        ]

        let products = [];
        let cart = [];
        let currentCategory = 'all';
        let generatedReceiptText = "";

        document.addEventListener('DOMContentLoaded', () => {
            loadDataOnline(); 
        });

        // 2. FUN√á√ïES DE DADOS (ONLINE)
        async function loadDataOnline() {
            showToast("Verificando estoque...", "info");
            try {
                const response = await fetch(API_URL + '/latest', {
                    headers: { 'X-Master-Key': API_KEY }
                });
                if (!response.ok) throw new Error("Erro de conex√£o");
                const data = await response.json();
                
                // VERIFICA SE OS DADOS ONLINE T√äM FOTO (IMAGE). SE N√ÉO, USA O DEFAULT.
                // Isso serve para atualizar a estrutura antiga de emojis para a nova de imagens.
                let onlineData = data.record;
                if(!onlineData[0].image) {
                    // Se o dado online n√£o tem o campo "image", assumimos que √© a vers√£o antiga
                    // e for√ßamos o uso do defaultProducts que tem as imagens.
                    console.log("Atualizando estrutura de dados...");
                    products = defaultProducts; 
                    saveDataOnline(); // Salva a nova estrutura na nuvem
                } else {
                    products = onlineData;
                }

                renderCatalog();
                updateCartUI();
            } catch (error) {
                console.error(error);
                useLocalFallback();
            }
        }

        async function saveDataOnline() {
            showToast("Salvando...", "info");
            try {
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                    body: JSON.stringify(products)
                });
                if (!response.ok) throw new Error("Erro ao salvar");
                showToast("Estoque atualizado!", "success");
            } catch (error) {
                showToast("Erro ao salvar online.", "error");
            }
        }

        function useLocalFallback() {
            products = JSON.parse(JSON.stringify(defaultProducts));
            renderCatalog();
        }

        // 3. RENDERIZA√á√ÉO E FILTROS
        function filterCategory(cat, element) {
            currentCategory = cat;
            document.querySelectorAll('.category-pill').forEach(el => el.classList.remove('active'));
            if(element) element.classList.add('active');
            document.getElementById('searchInput').value = '';
            renderCatalog();
        }

        document.getElementById('searchInput').addEventListener('input', () => renderCatalog());

        function renderCatalog() {
            const grid = document.getElementById('productGrid');
            const term = document.getElementById('searchInput').value.toLowerCase();
            grid.innerHTML = '';
            let count = 0;

            if(!products || products.length === 0) return;

            products.forEach(p => {
                if (currentCategory !== 'all' && p.category !== currentCategory) return;
                if (term && !p.name.toLowerCase().includes(term)) return;

                count++;
                const isSoldOut = p.soldOut || p.stock <= 0;
                const btnTxt = isSoldOut ? 'Esgotado' : 'Adicionar';
                const toggleTxt = isSoldOut ? 'Reativar' : 'Esgotar';
                const toggleClass = isSoldOut ? 'active' : '';

                const html = `
                    <article class="product-card ${isSoldOut ? 'sold-out' : ''}">
                        <div class="sold-out-badge">ESGOTADO</div>
                        
                        <div class="product-img-container">
                            <img src="${p.image || 'https://via.placeholder.com/400x300?text=Sem+Foto'}" alt="${p.name}" class="product-img">
                        </div>
                        
                        <div class="product-info">
                            <div class="product-cat-tag">${p.category}</div>
                            <div class="product-name">${p.name}</div>
                            <div class="product-desc">${p.desc}</div>
                            <div class="product-stock">Estoque: ${p.stock} un</div>
                            <div class="product-price">R$ ${p.price.toFixed(2).replace('.', ',')}</div>
                        </div>
                        
                        <div style="padding: 0 15px 15px 15px;">
                            <div class="user-controls">
                                <button class="qty-btn-card" onclick="changeTempQty(${p.id}, -1)" ${isSoldOut?'disabled':''}>‚àí</button>
                                <input id="qty-sel-${p.id}" class="qty-input-card" value="1" readonly>
                                <button class="qty-btn-card" onclick="changeTempQty(${p.id}, 1)" ${isSoldOut?'disabled':''}>+</button>
                            </div>
                            
                            <button class="add-cart-btn" onclick="addToCart(${p.id})" ${isSoldOut?'disabled':''}>
                                ${btnTxt}
                            </button>

                            <div class="admin-panel">
                                <div class="admin-row">
                                    <input type="number" id="stock-${p.id}" class="admin-input" value="${p.stock}">
                                    <button class="admin-btn btn-update" onclick="adminUpdateStock(${p.id})">Salvar</button>
                                </div>
                                <button class="admin-btn btn-toggle ${toggleClass}" onclick="adminToggleStatus(${p.id})">${toggleTxt}</button>
                            </div>
                        </div>
                    </article>
                `;
                grid.innerHTML += html;
            });
            document.getElementById('noResults').style.display = count === 0 ? 'block' : 'none';
        }

        // 4. CARRINHO
        function changeTempQty(id, delta) {
            const el = document.getElementById(`qty-sel-${id}`);
            let val = parseInt(el.value) + delta;
            if(val < 1) val = 1;
            el.value = val;
        }

        function addToCart(id) {
            const p = products.find(x => x.id === id);
            const qtdInput = document.getElementById(`qty-sel-${id}`);
            const qtd = parseInt(qtdInput.value);

            if(p.soldOut || p.stock <= 0) return showToast('Produto esgotado!', 'error');
            const item = cart.find(x => x.id === id);
            const currentQtd = item ? item.qty : 0;
            if(currentQtd + qtd > p.stock) return showToast(`Estoque insuficiente.`, 'error');

            if(item) item.qty += qtd;
            else cart.push({...p, qty: qtd});

            qtdInput.value = 1; 
            updateCartUI();
            showToast('Adicionado!', 'success');
        }

        function updateCartUI() {
            const container = document.getElementById('cartItemsContainer');
            const badge = document.getElementById('floatingCartCount');
            const totalEl = document.getElementById('cartTotalValue');
            
            container.innerHTML = '';
            let total = 0;
            let count = 0;

            if(cart.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999; padding:20px;">Sua cesta est√° vazia.</p>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price * item.qty;
                    count += item.qty;
                    container.innerHTML += `
                        <div class="cart-item">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div style="width:40px; height:40px; overflow:hidden; border-radius:8px;">
                                    <img src="${item.image}" style="width:100%; height:100%; object-fit:cover;">
                                </div>
                                <div>
                                    <div style="font-weight:700; font-size:0.95rem;">${item.name}</div>
                                    <div style="font-size:0.8rem; color:#666">${item.qty}x R$ ${item.price.toFixed(2)}</div>
                                </div>
                            </div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <strong>R$ ${(item.qty*item.price).toFixed(2).replace('.',',')}</strong>
                                <button onclick="removeFromCart(${idx})" style="color:var(--danger); border:none; background:none; font-weight:bold; font-size:1.2rem;">&times;</button>
                            </div>
                        </div>
                    `;
                });
            }
            badge.innerText = count;
            totalEl.innerText = 'R$ ' + total.toFixed(2).replace('.', ',');
        }

        function removeFromCart(idx) { cart.splice(idx, 1); updateCartUI(); }
        function clearCart() { if(cart.length > 0 && confirm('Limpar cesta?')) { cart = []; updateCartUI(); } }
        function toggleCartView() {
            const el = document.getElementById('cartSection');
            if(el.style.display === 'block') {
                el.style.display = 'none';
                el.classList.remove('open');
            } else {
                el.style.display = 'block';
                el.classList.add('open');
                el.scrollIntoView({behavior:'smooth'});
            }
        }

        // 5. CHECKOUT E WHATSAPP
        function generateReceipt() {
            if (cart.length === 0) return showToast('Cesta vazia!', 'error');
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();

            if (!name || !phone) {
                showToast('Preencha seus dados!', 'error');
                document.querySelector('.client-form').scrollIntoView({behavior: 'smooth'});
                return;
            }

            let msg = `*PEDIDO - COELHO QUEIJOS*\n--------------------------------\n`;
            msg += `üë§ Cliente: ${name}\nüì± Contato: ${phone}\n`;
            msg += `üìÖ Data: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString().slice(0,5)}\n`;
            msg += `--------------------------------\n`;
            
            let total = 0;
            cart.forEach(item => {
                const sub = item.price * item.qty;
                msg += `[${item.qty}x] ${item.name}\n      R$ ${sub.toFixed(2).replace('.', ',')}\n`;
                total += sub;
            });
            msg += `--------------------------------\n*TOTAL: R$ ${total.toFixed(2).replace('.', ',')}*\n--------------------------------\nAguardando confirma√ß√£o.`;

            generatedReceiptText = msg;
            document.getElementById('receiptText').innerText = generatedReceiptText;
            document.getElementById('receiptModal').classList.add('open');
        }

        function closeReceipt() { document.getElementById('receiptModal').classList.remove('open'); }
        function sendWhatsapp() {
            const storePhone = "5513988534927"; 
            window.open(`https://wa.me/${storePhone}?text=${encodeURIComponent(generatedReceiptText)}`, '_blank');
        }
        function copyReceipt() { navigator.clipboard.writeText(generatedReceiptText).then(() => showToast("Copiado!", 'success')); }

        // 6. ADMIN
        function showAdminForm() {
            document.getElementById('adminLoginTrigger').style.display = 'none';
            document.getElementById('adminLoginForm').classList.add('show');
        }
        function loginAdmin() {
            if (document.getElementById('adminPass').value === 'admin') {
                document.body.classList.add('admin-active');
                document.getElementById('adminLoginForm').classList.remove('show');
                document.getElementById('adminLogoutArea').style.display = 'block';
                renderCatalog();
                showToast('Modo Editor Ativado', 'info');
            } else { showToast('Senha inv√°lida', 'error'); }
        }
        function logoutAdmin() {
            document.body.classList.remove('admin-active');
            document.getElementById('adminLogoutArea').style.display = 'none';
            document.getElementById('adminLoginTrigger').style.display = 'block';
            renderCatalog();
            showToast('Saiu do modo editor', 'info');
        }
        function adminUpdateStock(id) {
            const val = parseInt(document.getElementById(`stock-${id}`).value);
            const p = products.find(x => x.id === id);
            if(p) {
                p.stock = val;
                if(p.stock > 0 && p.soldOut) p.soldOut = false;
                if(p.stock <= 0) p.soldOut = true;
                saveDataOnline(); renderCatalog();
            }
        }
        function adminToggleStatus(id) {
            const p = products.find(x => x.id === id);
            if(p) { p.soldOut = !p.soldOut; saveDataOnline(); renderCatalog(); }
        }

        // 7. TOAST
        function showToast(msg, type='success') {
            const box = document.getElementById('toast-container');
            const el = document.createElement('div');
            el.className = `toast ${type}`; el.innerText = msg;
            box.appendChild(el);
            setTimeout(() => el.classList.add('visible'), 10);
            setTimeout(() => { el.classList.remove('visible'); setTimeout(()=>el.remove(), 300); }, 3000);
        }
    </script>
</body>
</html>
